<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1020" />
  <title>Taxi Ledger</title>
  <link rel="manifest" href="./manifest.webmanifest" />

  <!-- Google Identity Services (OAuth token) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- Google API client -->
  <script src="https://apis.google.com/js/api.js" async defer></script>

  <style>
    /* ----------------------------
      PRO UI THEME (2026)
    ---------------------------- */
    :root{
      --bg:#070a14;
      --bg2:#0a1022;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.09);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.14);
      --text: #eef3ff;
      --muted: rgba(238,243,255,.66);
      --muted2: rgba(238,243,255,.48);
      --accent: #6aa7ff;
      --accent2:#7c5cff;
      --ok:#34d399;
      --warn:#fbbf24;
      --danger:#ff5b7a;

      --r12: 12px;
      --r16: 16px;
      --r20: 20px;
      --r24: 24px;

      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --shadow2: 0 10px 28px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: var(--bg);
      overflow-x:hidden;
    }

    /* âœ… Background fix:
       - fixed layer + gradient + subtle noise
       - no seams on scroll
    */
    .bg{
      position: fixed;
      inset: 0;
      z-index:-2;
      background:
        radial-gradient(1200px 700px at 18% -12%, rgba(106,167,255,.28), transparent 62%),
        radial-gradient(1000px 700px at 88% 2%, rgba(124,92,255,.22), transparent 62%),
        radial-gradient(900px 600px at 70% 110%, rgba(52,211,153,.12), transparent 60%),
        linear-gradient(180deg, #050712 0%, #070a14 30%, #0a1022 100%);
      transform: translateZ(0);
    }
    .bg::after{
      content:"";
      position:absolute; inset:0;
      background-image:
        radial-gradient(rgba(255,255,255,.05) 1px, transparent 1px);
      background-size: 3px 3px;
      opacity: .07;
      mix-blend-mode: overlay;
      pointer-events:none;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px calc(92px + env(safe-area-inset-bottom));
    }

    /* Top App Bar */
    .appbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .logo{
      width:44px; height:44px;
      border-radius: 16px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.35), transparent 60%),
        linear-gradient(135deg, rgba(106,167,255,.85), rgba(124,92,255,.85));
      box-shadow: 0 18px 40px rgba(106,167,255,.18);
      border:1px solid rgba(255,255,255,.12);
      display:grid; place-items:center;
      font-weight: 1000;
    }
    .brand h1{
      margin:0;
      font-size: 22px;
      letter-spacing: .2px;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand .sub{
      margin-top:4px;
      color: var(--muted);
      font-size: 12.5px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .datePill{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      box-shadow: var(--shadow2);
    }
    .datePill span{opacity:.9}
    input[type="date"]{
      background: transparent;
      color: var(--text);
      border: none;
      outline: none;
      font-weight: 800;
      font-size: 14px;
    }

    /* Layout */
    .grid{
      display:grid;
      gap: 12px;
    }
    @media(min-width: 780px){
      .grid{
        grid-template-columns: 1.1fr .9fr;
        align-items:start;
      }
    }

    .card{
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border-radius: var(--r24);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardInner{
      padding: 14px;
    }
    .cardTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 14px;
      border-bottom:1px solid var(--stroke);
      background: rgba(0,0,0,.10);
    }
    .cardTitle .t{
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .badge{
      font-size: 12px;
      color: var(--muted);
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      padding: 6px 10px;
      border-radius: 999px;
      white-space:nowrap;
    }

    /* KPIs */
    .kpis{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .kpi{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.12);
      border-radius: var(--r20);
      padding: 12px;
    }
    .kpi .label{color: var(--muted); font-size: 12px}
    .kpi .val{margin-top:6px; font-size: 22px; font-weight: 1000}
    .kpi.net .val{color: rgba(52,211,153,.95)}
    .kpi.total .val{color: rgba(106,167,255,.95)}

    /* Fields */
    .fieldLabel{
      margin: 12px 2px 6px;
      color: var(--muted);
      font-size: 12.5px;
      font-weight: 800;
    }
    .field{
      width:100%;
      padding: 14px 14px;
      border-radius: var(--r20);
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.14);
      color: var(--text);
      outline:none;
      font-size: 16px;
      font-weight: 800;
    }
    .field:focus{
      border-color: rgba(106,167,255,.55);
      box-shadow: 0 0 0 4px rgba(106,167,255,.14);
    }

    /* Buttons */
    .btn{
      width:100%;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: var(--r20);
      padding: 14px 14px;
      font-weight: 1000;
      font-size: 15px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      position:relative;
      overflow:hidden;
    }
    .btn:active{transform: translateY(1px)}
    /* nicer ripple-ish */
    .btn::after{
      content:"";
      position:absolute;
      inset:-40%;
      background: radial-gradient(circle at var(--x,50%) var(--y,50%), rgba(255,255,255,.18), transparent 45%);
      opacity:0;
      transition: opacity .25s ease;
      pointer-events:none;
    }
    .btn:active::after{opacity:1}
    .btn.primary{
      border-color: rgba(106,167,255,.35);
      background: linear-gradient(135deg, rgba(106,167,255,.85), rgba(124,92,255,.75));
      box-shadow: 0 16px 40px rgba(106,167,255,.18);
    }
    .btn.ghost{
      background: rgba(255,255,255,.05);
    }
    .btn.danger{
      border-color: rgba(255,91,122,.32);
      background: rgba(255,91,122,.10);
    }
    .btnRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .btnSmall{
      padding: 12px 12px;
      font-size: 13.5px;
      border-radius: 16px;
    }

    /* Expenses */
    .expense-item{
      display:grid;
      grid-template-columns: 1fr 132px 48px;
      gap:10px;
      align-items:center;
      margin: 10px 0;
    }
    .miniBtn{
      width:48px; height:48px;
      border-radius: 16px;
      border:1px solid rgba(255,91,122,.28);
      background: rgba(255,91,122,.10);
      color: var(--text);
      font-weight: 1000;
      cursor:pointer;
    }
    .miniBtn:active{transform: translateY(1px)}

    /* Pills */
    .pill{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.12);
      border-radius: 999px;
      padding: 10px 12px;
      color: var(--muted);
      font-size: 12.8px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      align-items:center;
    }

    /* Tabs bottom */
    .tabs{
      position: fixed;
      left:0; right:0; bottom:0;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: rgba(5,7,18,.72);
      backdrop-filter: blur(14px);
      border-top:1px solid rgba(255,255,255,.10);
      display:flex;
      gap:10px;
      justify-content:center;
      z-index: 50;
    }
    .tab{
      flex:1; max-width: 340px;
      border-radius: 18px;
      padding: 12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight: 1000;
      display:flex; align-items:center; justify-content:center; gap:10px;
    }
    .tab.active{
      background: rgba(106,167,255,.16);
      border-color: rgba(106,167,255,.35);
      box-shadow: 0 18px 40px rgba(106,167,255,.10);
    }

    /* Views */
    .view{display:none}
    .view.active{display:block}

    /* History items */
    .historyItem{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.12);
      border-radius: var(--r20);
      padding: 12px;
      display:flex;
      justify-content:space-between;
      gap: 12px;
      cursor:pointer;
      transition: transform .08s ease;
    }
    .historyItem:active{transform: translateY(1px)}
    .historyMeta{color:var(--muted); font-size:12px; margin-top:6px; line-height:1.25}
    .historyNet{font-weight:1000; white-space:nowrap}

    /* Toast */
    .toast{
      position: fixed;
      left:50%; transform:translateX(-50%);
      bottom: 92px;
      background: rgba(0,0,0,.68);
      border: 1px solid rgba(255,255,255,.12);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      display:none;
      z-index: 9999;
      max-width: calc(100% - 24px);
      text-align:center;
    }
  </style>

  <script defer src="./db.js"></script>
  <script defer src="./drive-sync.js"></script>
  <script defer src="./app.js"></script>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>

  <div class="wrap">
    <!-- App Bar -->
    <div class="appbar">
      <div class="brand">
        <div class="logo">TL</div>
        <div style="min-width:0">
          <h1>Taxi Ledger</h1>
          <div class="sub">Î¤Î¶Î¯ÏÎ¿Ï‚ â€¢ ÎœÏ€Î¿Ï…ÏÎ¼Ï€Î¿Ï…Î¬Ï â€¢ Î†Î»Î»Î± â€¢ ÎˆÎ¾Î¿Î´Î±</div>
        </div>
      </div>

      <div class="datePill">
        <span>ğŸ“…</span>
        <input id="dateInput" type="date" />
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: Entry -->
      <div id="view-entry" class="view active">
        <div class="card">
          <div class="cardTitle">
            <div class="t">ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</div>
            <div class="badge">Auto-save: <span id="autosaveState">Î­Ï„Î¿Î¹Î¼Î¿</span></div>
          </div>

          <div class="cardInner">
            <div class="kpis">
              <div class="kpi">
                <div class="label">Î¤Î¶Î¯ÏÎ¿Ï‚</div>
                <div id="kpiRevenue" class="val">0,00 â‚¬</div>
              </div>
              <div class="kpi">
                <div class="label">ÎœÏ€Î¿Ï…ÏÎ¼Ï€Î¿Ï…Î¬Ï + Î†Î»Î»Î±</div>
                <div id="kpiExtras" class="val">0,00 â‚¬</div>
              </div>
              <div class="kpi total">
                <div class="label">ÎŒÎ»Î± Î¼Î±Î¶Î¯</div>
                <div id="kpiTotal" class="val">0,00 â‚¬</div>
              </div>
              <div class="kpi net">
                <div class="label">ÎšÎ±Î¸Î±ÏÏŒ Î¼ÎµÏ„Î¬ Ï„Î± Î­Î¾Î¿Î´Î±</div>
                <div id="kpiNet" class="val">0,00 â‚¬</div>
              </div>
            </div>

            <div class="fieldLabel">Î¤Î¶Î¯ÏÎ¿Ï‚ (â‚¬)</div>
            <input id="revenue" class="field" inputmode="decimal" type="number" step="0.01" placeholder="Ï€.Ï‡. 250" />

            <div class="fieldLabel">ÎœÏ€Î¿Ï…ÏÎ¼Ï€Î¿Ï…Î¬Ï (â‚¬)</div>
            <input id="tip1" class="field" inputmode="decimal" type="number" step="0.01" placeholder="Ï€.Ï‡. 25" />

            <div class="fieldLabel">Î†Î»Î»Î± (â‚¬)</div>
            <input id="tip2" class="field" inputmode="decimal" type="number" step="0.01" placeholder="Ï€.Ï‡. 50" />

            <div class="fieldLabel">Î£ÏÎ½Î¿Î»Î¿ ÎµÎ¾ÏŒÎ´Ï‰Î½ (â‚¬)</div>
            <input id="expensesTotal" class="field" type="number" step="0.01" value="0.00" readonly />

            <div style="height:12px"></div>
            <button id="addExpenseBtn" class="btn ghost"
              onpointerdown="this.style.setProperty('--x', (event.offsetX||0)+'px'); this.style.setProperty('--y', (event.offsetY||0)+'px');">
              + Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÎ¾ÏŒÎ´Î¿Ï…
            </button>

            <div id="expensesList"></div>

            <div class="fieldLabel">Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚</div>
            <input id="note" class="field" placeholder="Ï€.Ï‡. ÎºÎ±ÏÏƒÎ¹Î¼Î±, Î²ÏÎ¿Ï‡Î®, Î±ÎµÏÎ¿Î´ÏÏŒÎ¼Î¹Î¿..." />

            <div style="height:12px"></div>
            <button id="saveBtn" class="btn primary"
              onpointerdown="this.style.setProperty('--x', (event.offsetX||0)+'px'); this.style.setProperty('--y', (event.offsetY||0)+'px');">
              ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·
            </button>

            <div style="height:12px"></div>

            <div class="card" style="border-radius:20px; background: rgba(0,0,0,.10); box-shadow:none">
              <div class="cardTitle" style="border-bottom:1px solid rgba(255,255,255,.10)">
                <div class="t">Google Drive Sync</div>
                <div class="badge">backup</div>
              </div>
              <div class="cardInner">
                <div id="syncState" class="pill" style="justify-content:flex-start; gap:10px">
                  ğŸ”´ Offline â€¢ â›” Sync OFF â€¢ ğŸ”“ Google: ÏŒÏ‡Î¹
                </div>

                <div style="height:10px"></div>

                <label class="pill" style="cursor:pointer">
                  <span>âœ… Auto-sync (ÏŒÏ„Î±Î½ ÎµÎ¯ÏƒÎ±Î¹ Î®Î´Î· ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï‚)</span>
                  <input id="syncToggle" type="checkbox" style="transform:scale(1.15)" />
                </label>

                <div style="height:10px"></div>

                <div class="btnRow">
                  <button id="syncLoginBtn" class="btn btnSmall"
                    onpointerdown="this.style.setProperty('--x', (event.offsetX||0)+'px'); this.style.setProperty('--y', (event.offsetY||0)+'px');">
                    Î£ÏÎ½Î´ÎµÏƒÎ· Google
                  </button>

                  <button id="syncBtn" class="btn btnSmall"
                    onpointerdown="this.style.setProperty('--x', (event.offsetX||0)+'px'); this.style.setProperty('--y', (event.offsetY||0)+'px');">
                    â« Sync Ï„ÏÏÎ±
                  </button>
                </div>

                <div style="height:10px"></div>

                <button id="restoreBtn" class="btn btnSmall danger"
                  onpointerdown="this.style.setProperty('--x', (event.offsetX||0)+'px'); this.style.setProperty('--y', (event.offsetY||0)+'px');">
                  â¬ Restore
                </button>

                <div style="height:10px"></div>
                <div class="pill" style="font-size:12px; color:var(--muted2)">
                  <span>Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·</span>
                  <span>Clear site data = ÏƒÎ²Î®Î½Î¿Î½Ï„Î±Î¹ Ï„Î¿Ï€Î¹ÎºÎ¬. Drive = ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬.</span>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- RIGHT: History / Summary container -->
      <div>
        <div id="view-history" class="view">
          <div class="card">
            <div class="cardTitle">
              <div class="t">Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ</div>
              <div class="badge">tap Î³Î¹Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î·Î¼Î­ÏÎ±Ï‚</div>
            </div>
            <div class="cardInner">
              <div id="historyList"></div>
            </div>
          </div>
        </div>

        <div id="view-summary" class="view">
          <div class="card">
            <div class="cardTitle">
              <div class="t">Î£ÏÎ½Î¿Î»Î±</div>
              <div class="badge">ÏŒÎ»Î¿ Ï„Î¿ Î´Î¹Î¬ÏƒÏ„Î·Î¼Î±</div>
            </div>
            <div class="cardInner">
              <div class="pill"><span>Î—Î¼Î­ÏÎµÏ‚</span><span id="sumDays">0</span></div>
              <div style="height:8px"></div>
              <div class="pill"><span>Î¤Î¶Î¯ÏÎ¿Ï‚</span><span id="sumRevenue">0,00 â‚¬</span></div>
              <div style="height:8px"></div>
              <div class="pill"><span>ÎœÏ€Î¿Ï…ÏÎ¼Ï€Î¿Ï…Î¬Ï</span><span id="sumTip1">0,00 â‚¬</span></div>
              <div style="height:8px"></div>
              <div class="pill"><span>Î†Î»Î»Î±</span><span id="sumTip2">0,00 â‚¬</span></div>
              <div style="height:8px"></div>
              <div class="pill"><span>ÎˆÎ¾Î¿Î´Î±</span><span id="sumExpenses">0,00 â‚¬</span></div>
              <div style="height:8px"></div>
              <div class="pill"><span>ÎŒÎ»Î± Î¼Î±Î¶Î¯</span><span id="sumAllIn">0,00 â‚¬</span></div>
              <div style="height:8px"></div>
              <div class="pill"><span>ÎšÎ±Î¸Î±ÏÏŒ</span><span id="sumNet">0,00 â‚¬</span></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="entry">â• ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·</button>
    <button class="tab" data-tab="history">ğŸ“š Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ</button>
    <button class="tab" data-tab="summary">ğŸ“Š Î£ÏÎ½Î¿Î»Î±</button>
  </div>

  <div id="toast" class="toast"></div>
</body>
</html>